<!-- <body class="famroombg"> -->
<%= subscribe_to "/messages/familyroom" %>
<%= subscribe_to "/familyroom/game" %>

<script>
// keep player chat and score list current, check for 3+ players
setInterval(function() {
  $("#userlistbox").load("/room/familyroom #userlistbox");
}, 5114 );

function userLeaves(){
  $.ajax({
    url: "/room/destroyplayer",
    type: "post"
  });
}

$(window).on('beforeunload', function () {
  var leavemsg = new Array('[Host] <%= current_user.username %> has left the room.',
    '[Host] <%= current_user.username %> has vanished.',
    '[Host] <%= current_user.username %> has disappeared',
    '[Host] <%= current_user.username %> has departed.',
    '[Host] <%= current_user.username %> is now elsewhere.',
    '[Host] <%= current_user.username %> has gone away.',
    '[Host] The room is now empty of <%= current_user.username %>.',
    '[Host] <%= current_user.username %> has escaped.',
    '[Host] <%= current_user.username %> is not here anymore.',
    '[Host] The room misses <%= current_user.username %> now.',
    '[Host] <%= current_user.username %> went to another place.');
  var ranleavemsg = leavemsg[Math.floor(Math.random() * leavemsg.length)];
  $('#hostmsg #message_content').val(ranleavemsg);
  $('#hostmsg').submit();
  userLeaves();
});

$(window).bind('beforeunload', function(){
  userLeaves();
});
// prevent backspace from leaving page
$(document).unbind('keydown').bind('keydown', function (event) {
  var doPrevent = false;
  if (event.keyCode === 8) {
    var d = event.srcElement || event.target;
    if ((d.tagName.toUpperCase() === 'INPUT' && (d.type.toUpperCase() === 'TEXT' || d.type.toUpperCase() === 'PASSWORD' || d.type.toUpperCase() === 'FILE' || d.type.toUpperCase() === 'EMAIL' ))
         || d.tagName.toUpperCase() === 'TEXTAREA') {
      doPrevent = d.readOnly || d.disabled;
    }
    else {
      doPrevent = true;
    }
  }

  if (doPrevent) {
      event.preventDefault();
  }
});
</script>

<div class="row">
  <div class="small-6 columns centerall">
    <h2 id="roundtext"></h2>
  </div>
  <h2><div id="timertext" class="small-6 columns centerall">

  </div></h2>
</div>

<div class="row">
  <div id="votediv" class="small-12 columns centerall animated flip" style="font-size:110%;">
    <i id="votecat" class="small-12 columns centerall animated flip" style="font-size:80%; margin-bottom:4px; margin-top:4px; display:none;"></i>
    <% @famroomanswersminusplayer.shuffle.each do |answer| %>
      <div style="float: left; font-size:70%; margin-right:4px;">
        <%= button_to "Vote", {:controller => "room", :action => "votefor", :id => answer.id, :method => "put"}, :class => "votebuttons", :style => "position:relative; z-index:900000;", remote: true %>
      </div>
      "<%= Obscenity.replacement(:stars).sanitize(answer.answer) %>"
    </br></br>
    <% end %>
    Yours: "<%= Obscenity.replacement(:stars).sanitize(@noownvote) %>"
  </div>
</div>

<div class="row">
  <div id="resultsdiv" class="small-12 columns centerall animated fadeIn" style="font-size:100%;">
    <div id="roundwinnerannounce" class="centerall">
      Winner, <%= @roundwinner.username %>! <%= image_tag @roundwinner.avatar.url(:small) %> <%= @bonuspointsshow %> bonus points!</br>
    </div>
    <% Famroomanswer.order('points DESC').each do |answer| %>
      <li class="answerresultinfo" style="display:none; font-size:85%; margin-right:4px;">
        <%= answer.points %> votes for <%= answer.user.username %>:
        "<%= Obscenity.replacement(:stars).sanitize(answer.answer) %>" (<%= answer.answertime %>s)</li>
      </br>
    <% end %>
    <p id="fastestanswer" class="centerall" style="display:none;">
      Fastest answer with at least one vote: <%= @fastestanswer.username %> (+2 points!)
    </p>
    <p id="winninganswervoters" class="centerall" style="display:none;">
      Voted for the winning answer:
      <% @winninganswervoters.each do |psychic| %>
      <%= psychic.username %>,
      <% end %>
      (+1 point!)
    </p>
    <p id="nonvoters" class="centerall" style="display:none;">
      Non-voters receive no points.
    </p>

  </div>
</div>

<div class="row">
  <div id="endofgamediv" class="small-12 columns centerall animated fadeIn" style="font-size:110%;">
      Congratulations, <%= @gamewinner.username %> with <%= @gamewinner.gamepoints %> points! </br></br>
      <%= image_tag @gamewinner.avatar.url(:small) %></br></br>
      <%= @gamewinner.username %> has now won <%= @gamewinner.gameswon %> games! </br></br>
      Next game coming right up...
  </div>
</div>

<div class="row">
  <div class="small-4 columns centerall">
    <p id="submittedtext" style="height:16px; margin-top:14px;">Answers Submitted: <%= Famroomanswer.count %></p>
  </div>
  <h3>
    <div id="categorytext" class="small-4 columns centerall">
    </div>
  </h3>
  <div class="small-4 columns centerall">
    <p id="acceptedtext" style="font-size:120%; color:green; height:16px;">Answer Accepted (<%= @submissiontime %>s)
    </p>
  </div>
</div>

<div class="row">
  <div class="small-10 small-centered acrotable acrofont centerall">

    <p id="acroletters" class="verticalcenter" style="font-size:340%; margin-top:-28px; margin-bottom:40px;">
      </p>
  </div>
</div>

<div id="answerformdiv" class="row">
  <%= form_for Famroomanswer.new, :html => {:id => "answerform"}, remote: true do |a| %>
    <div id="answerfield" class="small-8 small-centered columns centerall">
      <%= a.hidden_field :user_id, :value => current_user.id %>
      <%= a.hidden_field :round, :id => "answerroundnumber" %>
      <%= a.hidden_field :roundstarted, :id => "answerroundstarted" %>
      <%= a.hidden_field :category, :id => "answercategory" %>
      <%= a.hidden_field :acroletters, :id => "answeracroletters" %>
      <%= a.text_field :answer, :id => "answertextfield", :style => "font-size:1.7em; visibility:hidden; height:44px", :placeholder => "Write your acro here, press Enter to submit..." %>
    </div>
    <%= a.submit "", :id => "answersubmit", :style => "display:none;" %>
  <% end %>
</div>

<div class="row">
  <div class="small-3 columns">
    <div class="small-12 float-right usertable" style="padding-left:6px; background:#d1fffe;">
      <div id="userlistbox"><u><%= @playerlist.count %>/12 players:</u>
        <span style="float:right; margin-right:6px;"><u>points</u></span><br />
        <% @playerlist.joins(:user).order('users.gamepoints DESC').each do |player| %>
          <%= player.name %><span style="float:right; padding-right:6px;"><%= player.user.gamepoints%></span><br />
        <% end %>
      </div>
    </div>
  </div>
  <div class="small-7 columns">
    <div class="small-12 small-centered chattable" style="background:#d1fffe;" id="chatbox">
      <ul id="chat">
        <%= render @messages %>
      </ul>
    </div>
    <div class="small-12">
      <%= form_for Message.new, remote: true do |f| %>
        <div class="row">
          <div class="small-10 columns"><%= f.text_field :content, :placeholder => "Enter chat here...", :autofocus => true %></div>
          <%= f.hidden_field :user_id, :value => current_user.id %>
          <div class="small-2 columns"><%= f.submit "Send", :class => "button tiny radius centerall", :style => "margin-top:2px; margin-left:-6px" %>
          </div>
        </div>
      <% end %>
    </div>

    <div style="visibilty=hidden;">
      <%= form_for Message.new, html: { name: "hostmsg", id: "hostmsg" }, remote: true do |hostmessage| %>
        <div class="row">
          <%= hostmessage.hidden_field :content, :value => "[Host] Let's all welcome current_user.username" %>
          <div class="small-2 columns"><%= hostmessage.submit "Send", :style => "visibility:hidden;" %>
          </div>
        </div>
      <% end %>
    </div>

  </div>
  <div class="small-2 columns centerall">
    <%= button_tag "Sounds: On", :id => "sfxbutton", :class => "button small radius", :style => "margin-top:10px;" %>
    <%= button_tag "Music: On", :id => "musicbutton", :class => "button small radius", :style => "visibility:hidden;" %>
    <%= link_to "Leave room", foyer_path, :class => "alert button small radius" %>
    <div id="tweetwinner">
      <% if @roundwinner.id == current_user.id %>
        <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://acroparty.com" data-text='My winning acro! <%= @tweetacroletters %>: "<%= @tweetanswer %>" (<%= @tweetcat %>) Come play!' data-via="AcroParty" data-count="none">Tweet</a>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
        <span style="font-size:85%">your winner!</span>
      <% end %>
    </div>
  </div>
</div>

<div id="rndletters" style="display:none">
  ANRPOQLSJHEUDIJSNMSHERUHPLEDIHSWJEUIFHJDYHFGRBNMAHSTGERSTE<%= @round5letters %>DHJNAKSTECHGEYTCHJDHYUTHUHSJIPOWLKEIUTHYHFGYSTTREYAGHTSYRDTEGYFTDYHNDKJIOWKLPLWIJEHYFTGRAFTERDUHGFTYRTGETSJKIWYTGH<%= @round1letters %>WPJDKSIIRJWKALPFBFBFFBFFSCSCSDLCNCJKDLDK<%= @round2letters %>UQKLSDFREDFBYTMDFREESDHJKPS<%= @round3letters %>GWJHBDCJBVHBNCKSNUIHWEUIHUIJDFBJUIGBDCVUDUCHBDCVCVKJBCKYSHSCXGSKIGHOUJPGUDRRSWEQCDSXVCNBMNKLGJDFGDGCDJVKDHSTWEQWAFFGOJOJJGHFY<%= @round8letters %>YJHPQOWUDRGCBVJGKDHSGSTRFJJLKIYYRFRWESHFJBNBBSDSSAQQGEKIHJPJIOFMNXGZXRSHG<%= @round4letters %>EEAGDJVKCFGCFJFKLGHFGDFJGHLJPIOGLFKRTEFSGVCNNOJJFVFDSWAFDHGKHGKFNHDUFYTJGPJOJOHOIISDYSDTSEESRTDJGOLHRRSGHDKJVBUGHFKBLBFYDTGGSKFPBHIGYYSFSSWAQQQSZSGHDKJGGLPJLYHN<%= @round10letters %>GHFUVDFVYHHQTDHGFJHKLGHSYWASRQESGFIKHGJDBSKVG<%= @round7letters %>BVYHHIOKPLOKJIHYHGTFRDESWAWZXZSFFVBGNHHMJJLMIHGOPFIUETWQEQDSGHSKSDJHFGGFGOQTYRFUGKDGDFVVKJGJHDFSDFOJKIGGSEWQH<%= @round9letters %>FOODHDFWSREDSHFKPPGLGOGHKJIUUTGTEREWWQWAXXCVCH<%= @round6letters %>BKJJLOKIOPEDIWYLAKSJHFBVGFHUTHFJERGYSFSGSHSRQDDHJGOLJOGVHJVNCKSFSDCXCKVGVRSWQFSDJBLJPKKIGGCDASAZAXSGDCHGJHLJJGHDFXXZSACFDJNPOHJFGVDALSKCHCUUD2S



  <span id="catr1"><%= @round1cat %></span>
  <span id="catr2"><%= @round2cat %></span>
  <span id="catr3"><%= @round3cat %></span>
  <span id="catr4"><%= @round4cat %></span>
  <span id="catr5"><%= @round5cat %></span>
  <span id="catr6"><%= @round6cat %></span>
  <span id="catr7"><%= @round7cat %></span>
  <span id="catr8"><%= @round8cat %></span>
  <span id="catr9"><%= @round9cat %></span>
  <span id="catr10"><%= @round10cat %></span>

  <% if @playerlist.count >= 3 %>
    <span id="rnd1start"><%= @timer1write + 10.seconds %></span>
    <span id="rnd2start"><%= @timer2write + 10.25.seconds %></span>
    <span id="rnd3start"><%= @timer3write + 11.75.seconds %></span>
    <span id="rnd4start"><%= @timer4write + 13.25.seconds %></span>
    <span id="rnd5start"><%= @timer5write + 14.75.seconds %></span>
    <span id="rnd6start"><%= @timer6write + 8.75.seconds %></span>
    <span id="rnd7start"><%= @timer7write + 10.25.seconds %></span>
    <span id="rnd8start"><%= @timer8write + 11.75.seconds %></span>
    <span id="rnd9start"><%= @timer9write + 13.25.seconds %></span>
    <span id="rnd10start"><%= @timer10write + 14.75.seconds %></span>
  <% end %>

</div>

<div id="gamedata" style="display:none">
  <span id="roundtojoindiv"><%= @roundtojoin %></span>
  <span id="timetojoindiv"><%= @timetojoin %></span>
  <span id="playercountdiv"><%= @playerlist.count %></span>
</div>

<%= javascript_include_tag "game/scrollbardown" %>
<%= javascript_include_tag "game/game" %>

<script>
// player enters, message for all
window.onload=function(){
  var entermsg = new Array('[Host] <%= current_user.username %> has entered the room.',
    '[Host] <%= current_user.username %> has arrived.',
    '[Host] <%= current_user.username %> has appeared',
    '[Host] Welcome <%= current_user.username %> to the room.',
    '[Host] <%= current_user.username %> sneaks into the room.',
    '[Host] <%= current_user.username %> saunters into the room.',
    '[Host] The room feels the presence of <%= current_user.username %>.',
    '[Host] <%= current_user.username %> is now here.',
    '[Host] <%= current_user.username %> makes a grand appearance.',
    '[Host] The room welcomes <%= current_user.username %> now.',
    '[Host] <%= current_user.username %> is now present.');
  var ranentermsg = entermsg[Math.floor(Math.random() * entermsg.length)];
  $('#hostmsg #message_content').val(ranentermsg);
  $('#hostmsg').submit();
}

// sync game timing data
function stayInSync() {
  var roundtojoinraw = $("#roundtojoindiv").text();
  var roundtojoin = window[roundtojoinraw];
  var timetojoin = $("#timetojoindiv").text();
  setTimeout(roundtojoin, (timetojoin*1000) - 9000);
}


// try 5 times to load game time data for sync checks, notify if sync error
var loadTimesCounter = 0;
var loadTimesAndSyncCheck = function(nextround) {
  $("#gamedata").load("/room/familyroom #gamedata", function( response, status, xhr ) {
    if ( status == "error" || $("#roundtojoindiv").text() != nextround) {
      if (loadTimesCounter < 5) {
        function gamedataErrorLoading() {
          loadTimesCounter++;
          loadTimesAndSyncCheck();
          console.log('ERROR loading gamedata, try number ' + loadTimesCounter);
        }
        setTimeout(gamedataErrorLoading, 800);
      }
      else {
        loadTimesCounter = 0;
        console.log('ERROR - Connection problem after 5 data load tries - now in holding pattern...');
        function connectionProblem() {
          $(".ui-dialog-content").dialog("close");
          $('#answerfield').addClass('animated fadeOutDown');
          slideRoundText();
          $("#roundtext").text(". . .");
          $("#acroletters").removeClass('animated fadeOutUp');
          document.getElementById("acroletters").style.visibility="visible";
          $("#acroletters").css('fontSize', '100%')
                           .show()
                           .html("<br/>Connection problem.<br/>Trying to rejoin...");
          $("#gamedata").load("/room/familyroom #gamedata", function( response, status, xhr ) {
            if ( status == "error" ) {
              function tryingToConnect() {
                connectionProblem();
                console.log('Still unable to connect.');
              }
              setTimeout(tryingToConnect, 3000);
            }
            else {
              loadTimesCounter = 0;
              setTimeout(joinInProgress, 800);
            }
          });
        }
        connectionProblem();
      }
    }
    else {
      console.log('SUCCESS loading gamedata');
      loadTimeCounter = 0;
      if ($("#roundtojoindiv").text() == "newGameStarts"){
        setTimeout(stayInSync, 3000);
      }
      else {
        setTimeout(stayInSync, 10000);
      }
    }
    });
  };

// decide which JS event(game round) the player will join next, set up board

function joinInProgress() {
  var roundtojoinraw = $("#roundtojoindiv").text();
  var roundtojoin = window[roundtojoinraw];
  var timetojoin = $("#timetojoindiv").text();
  document.getElementById("acroletters").style.visibility="visible";
  document.getElementById("submittedtext").style.visibility="hidden";
  $("#acroletters").css('fontSize', '100%');
  $("#acroletters").html("<br/>Waiting to join...<br/>(about " + timetojoin + "s)");
  slideRoundText();
  $("#roundtext").text("Joining next round...");
  $('#answerfield').addClass('animated fadeOutDown');
  $("#answertextfield").attr("disabled", true);
  $("#answersubmit").attr("disabled", true);
  setTimeout(roundtojoin, timetojoin*1000);
}


// Host welcome message shown in chat box
hideTextStart();
$("#chat").append('<font color="purple">[Host] Welcome to the Family Room! This room is meant for all ages so please keep your acros and chat family friendly. And have fun!</font>');
$("#chatbox").scrollTop(10000);

function showTweet() {
  $("#tweetwinner").load("/room/familyroom #tweetwinner", function() {
    $.getScript('https://platform.twitter.com/widgets.js', function(){
      $("#tweetwinner").show();
      twttr.widgets.load();
    });
  });
}

function loadTweet() {
  $.ajax({
    url: "/room/updatewinnertweet",
    type: "POST",
    success: showTweet
  });
}

setTimeout(joinInProgress, 1500);
playerEnterInit();

// waiting for players
function waitingForPlayers() {
  var roundtojoinraw = $("#roundtojoindiv").text();
  var roundtojoin = window[roundtojoinraw];
  var timetojoin = $("#timetojoindiv").text();
  $(".ui-dialog-content").dialog("close");
  $('#answerfield').addClass('animated fadeOutDown');
  slideRoundText();
  $("#roundtext").text(". . .");
  document.getElementById("acroletters").style.visibility="visible";
  $("#acroletters").removeClass('animated fadeOutUp');
  $("#acroletters").show()
                   .html("<br/>Need 3 players<br/>to begin game...");
  $("#gamedata").load("/room/familyroom #gamedata");
  setTimeout(roundtojoin, timetojoin*1000);
}

// gameplay rounds
function newGameStarts() {
  $("#acroletters").text("");
  $('#answerfield').addClass('animated fadeOutDown');
  $("#rndletters").load("/room/familyroom #rndletters");
  slideRoundText();
  $("#roundtext").text("New game starting...");
  setTimeout(r1prep, <%= @newgamestartstime %>*1000);
}

function r1prep() {
  playerEnterInit();
  slideRoundText();
  $("#roundtext").text("Round 1/10 - Get ready!");
  $("#rndletters").load("/room/familyroom #rndletters");
  $("#answerformdiv").load("/room/familyroom #answerformdiv");
  $("#submittedtext").text("0");
  setTimeout(r1write, <%= @r1preptime %>*1000);
}

function r1write() {
  roundPrep();
  $("#rndletters").load("/room/familyroom #rndletters");
  var roundnumber = 1;
  var letters = $("#rndletters").text().match("GH(...)WP");
  var catfromdiv = $("#catr1").text();
  var rndstart = $("#rnd1start").text();
  $("#answerroundnumber").val(roundnumber);
  $("#answerroundstarted").val(rndstart);
  $("#answercategory").val(catfromdiv);
  $("#answeracroletters").val(letters[1]);
  slideRoundText();
  $("#roundtext").text("Round 1 - Write");
  enterCatText();
  $("#categorytext").text(catfromdiv);
  $("#acroletters").text(letters[1]);
  document.getElementById("acroletters").style.visibility="hidden";
  showLetters();
  $("#submittedtext").load("/room/familyroom #submittedtext");
  setTimeout(checkSubmittedNumber, 7000);
  $("#votediv").text("");
  $("#answerform").on('submit', function() {
    return acroValidate(letters[1]);
  });
  setTimeout(r1vote, <%= @r1writetime %>*1000);
}

function r1vote() {
  slideRoundText();
  document.getElementById("categorytext").style.visibility="hidden";
  document.getElementById("submittedtext").style.visibility="hidden";
  $("#acceptedtext").hide();
  function showCatForVote(){
    var catfromdiv = "Category: " + $("#catr1").text();
    $("#votecat").show();
    $("#votecat").text(catfromdiv);
  }
  setTimeout(showCatForVote, 2500);
  $("#roundtext").text("Round 1 - Vote");
  $('#answerfield').addClass('animated fadeOutDown');
  $("#acroletters").addClass('animated fadeOutUp');
  document.getElementById("answertextfield").style.visibility="hidden";
  $("#votediv").load("/room/familyroom #votediv");
  $("#resultsdiv").text("");
  setTimeout(votingRound, 2500);
  vtimer();
  playerCountCheck();
  setTimeout(r1res, <%= @r1votetime %>*1000);
}

function r1res() {
  slideRoundText();
  $("#votediv").dialog('close');
  $("#votediv").hide();
  $("#votecat").hide();
  $("#timertext").hide();
  $("#answertextfield").val("");
  $("#resultsdiv").load("/room/familyroom #resultsdiv");
  setTimeout(resultsRound, 2500);
  $("#roundtext").text("Round 1 - Results");
  $("#rndletters").load("/room/familyroom #rndletters");
  $("#gamedata").load("/room/familyroom #gamedata");
  setTimeout(loadTimesAndSyncCheck('r2prep'),2000); // next is r2prep or error
  $("#tweetwinner").hide();
  setTimeout(loadTweet, 5750);
}

function r2prep() {
  slideRoundText();
  hideResultsDialog();
  $("#roundtext").text("Round 2/10 - Get ready!");
  $("#answerformdiv").load("/room/familyroom #answerformdiv");
  $("#submittedtext").text("0");
  setTimeout(r2write, <%= @r2preptime %>*1000);
}

function r2write() {
  roundPrep();
  $("#rndletters").load("/room/familyroom #rndletters");
  var roundnumber = 2;
  var letters = $("#rndletters").text().match("DK(....)UQ");
  var catfromdiv = $("#catr2").text();
  var rndstart = $("#rnd2start").text();
  $("#answerroundnumber").val(roundnumber);
  $("#answerroundstarted").val(rndstart);
  $("#answercategory").val(catfromdiv);
  $("#answeracroletters").val(letters[1]);
  slideRoundText();
  $("#roundtext").text("Round 2 - Write");
  enterCatText();
  $("#categorytext").text(catfromdiv);
  $("#acroletters").text(letters[1]);
  document.getElementById("acroletters").style.visibility="hidden";
  showLetters();
  $("#submittedtext").load("/room/familyroom #submittedtext");
  setTimeout(checkSubmittedNumber, 8500);
  $("#votediv").text("");
  $("#answerform").submit(function() {
    return acroValidate(letters[1]);
  });
  setTimeout(r2vote, <%= @r2writetime %>*1000);
}

function r2vote() {
  slideRoundText();
  $("#acceptedtext").hide();
  function showCatForVote(){
    $("#votecat").show();
    $("#votecat").text("Category: <%= @round2cat %>");
  }
  setTimeout(showCatForVote, 2500);
  document.getElementById("categorytext").style.visibility="hidden";
  document.getElementById("submittedtext").style.visibility="hidden";
  $("#roundtext").text("Round 2 - Vote");
  $('#answerfield').addClass('animated fadeOutDown');
  $("#acroletters").addClass('animated fadeOutUp');
  document.getElementById("answertextfield").style.visibility="hidden";
  $("#votediv").load("/room/familyroom #votediv");
  $("#resultsdiv").text("");
  setTimeout(votingRound, 2500);
  vtimer();
  playerCountCheck();
  setTimeout(r2res, <%= @r2votetime %>*1000);
}

function r2res() {
  slideRoundText();
  $("#votediv").dialog('close');
  $("#votediv").hide();
  $("#votecat").hide();
  $("#timertext").hide();
  $("#answertextfield").val("");
  $("#resultsdiv").load("/room/familyroom #resultsdiv");
  setTimeout(resultsRound, 2500);
  $("#roundtext").text("Round 2 - Results");
  $("#rndletters").load("/room/familyroom #rndletters");
  $("#gamedata").load("/room/familyroom #gamedata");
  setTimeout(loadTimesAndSyncCheck('r3prep'),2000);
  $("#tweetwinner").hide();
  setTimeout(loadTweet, 5750);
}

function r3prep() {
  slideRoundText();
  hideResultsDialog();
  $("#roundtext").text("Round 3/10 - Get ready!");
  $("#answerformdiv").load("/room/familyroom #answerformdiv");
  $("#submittedtext").text("0");
  setTimeout(r3write, <%= @r3preptime %>*1000);
}

function r3write() {
  roundPrep();
  $("#rndletters").load("/room/familyroom #rndletters");
  var roundnumber = 3;
  var letters = $("#rndletters").text().match("PS(.....)GW");
  var catfromdiv = $("#catr3").text();
  var rndstart = $("#rnd3start").text();
  $("#answerroundnumber").val(roundnumber);
  $("#answerroundstarted").val(rndstart);
  $("#answercategory").val(catfromdiv);
  $("#answeracroletters").val(letters[1]);
  slideRoundText();
  $("#roundtext").text("Round 3 - Write");
  enterCatText();
  $("#categorytext").text(catfromdiv);
  $("#acroletters").text(letters[1]);
  document.getElementById("acroletters").style.visibility="hidden";
  showLetters();
  $("#submittedtext").load("/room/familyroom #submittedtext");
  setTimeout(checkSubmittedNumber, 10000);
  $("#votediv").text("");
  $("#answerform").submit(function() {
    return acroValidate(letters[1]);
  });
  setTimeout(r3vote, <%= @r3writetime %>*1000);
}

function r3vote() {
  slideRoundText();
  $("#acceptedtext").hide();
  function showCatForVote(){
    $("#votecat").show();
    $("#votecat").text("Category: <%= @round3cat %>");
  }
  setTimeout(showCatForVote, 2500);
  document.getElementById("categorytext").style.visibility="hidden";
  document.getElementById("submittedtext").style.visibility="hidden";
  $("#roundtext").text("Round 3 - Vote");
  $('#answerfield').addClass('animated fadeOutDown');
  $("#acroletters").addClass('animated fadeOutUp');
  document.getElementById("answertextfield").style.visibility="hidden";
  $("#votediv").load("/room/familyroom #votediv");
  $("#resultsdiv").text("");
  setTimeout(votingRound, 2500);
  vtimer();
  playerCountCheck();
  setTimeout(r3res, <%= @r3votetime %>*1000);
}

function r3res() {
  slideRoundText();
  $("#votediv").dialog('close');
  $("#votediv").hide();
  $("#votecat").hide();
  $("#timertext").hide();
  $("#answertextfield").val("");
  $("#resultsdiv").load("/room/familyroom #resultsdiv");
  setTimeout(resultsRound, 2500);
  $("#roundtext").text("Round 3 - Results");
  $("#rndletters").load("/room/familyroom #rndletters");
  $("#gamedata").load("/room/familyroom #gamedata");
  setTimeout(loadTimesAndSyncCheck('r4prep'),2000);
  $("#tweetwinner").hide();
  setTimeout(loadTweet, 5750);
}

function r4prep() {
  slideRoundText();
  hideResultsDialog();
  $("#roundtext").text("Round 4/10 - Get ready!");
  $("#answerformdiv").load("/room/familyroom #answerformdiv");
  $("#submittedtext").text("0");
  setTimeout(r4write, <%= @r4preptime %>*1000);
}

function r4write() {
  roundPrep();
  $("#rndletters").load("/room/familyroom #rndletters");
  var roundnumber = 4;
  var letters = $("#rndletters").text().match("HG(......)EE");
  var catfromdiv = $("#catr4").text();
  var rndstart = $("#rnd4start").text();
  $("#answerroundnumber").val(roundnumber);
  $("#answerroundstarted").val(rndstart);
  $("#answercategory").val(catfromdiv);
  $("#answeracroletters").val(letters[1]);
  slideRoundText();
  $("#roundtext").text("Round 4 - Write");
  enterCatText();
  $("#categorytext").text(catfromdiv);
  $("#acroletters").text(letters[1]);
  document.getElementById("acroletters").style.visibility="hidden";
  showLetters();
  $("#submittedtext").load("/room/familyroom #submittedtext");
  setTimeout(checkSubmittedNumber, 11500);
  $("#votediv").text("");
  $("#answerform").submit(function() {
    return acroValidate(letters[1]);
  });
  setTimeout(r4vote, <%= @r4writetime %>*1000);
}

function r4vote() {
  slideRoundText();
  $("#acceptedtext").hide();
  function showCatForVote(){
    $("#votecat").show();
    $("#votecat").text("Category: <%= @round4cat %>");
  }
  setTimeout(showCatForVote, 2500);
  document.getElementById("categorytext").style.visibility="hidden";
  document.getElementById("submittedtext").style.visibility="hidden";
  $("#roundtext").text("Round 4 - Vote");
  $('#answerfield').addClass('animated fadeOutDown');
  $("#acroletters").addClass('animated fadeOutUp');
  document.getElementById("answertextfield").style.visibility="hidden";
  $("#votediv").load("/room/familyroom #votediv");
  $("#resultsdiv").text("");
  setTimeout(votingRound, 2500);
  vtimer();
  playerCountCheck();
  setTimeout(r4res, <%= @r4votetime %>*1000);
}

function r4res() {
  slideRoundText();
  $("#votediv").dialog('close');
  $("#votediv").hide();
  $("#votecat").hide();
  $("#timertext").hide();
  $("#answertextfield").val("");
  $("#resultsdiv").load("/room/familyroom #resultsdiv");
  setTimeout(resultsRound, 2500);
  $("#roundtext").text("Round 4 - Results");
  $("#rndletters").load("/room/familyroom #rndletters");
  $("#gamedata").load("/room/familyroom #gamedata");
  setTimeout(loadTimesAndSyncCheck('r5prep'),2000);
  $("#tweetwinner").hide();
  setTimeout(loadTweet, 5750);
}

function r5prep() {
  slideRoundText();
  hideResultsDialog();
  $("#roundtext").text("Round 5/10 - Get ready!");
  $("#answerformdiv").load("/room/familyroom #answerformdiv");
  $("#submittedtext").text("0");
  setTimeout(r5write, <%= @r5preptime %>*1000);
}

function r5write() {
  roundPrep();
  $("#rndletters").load("/room/familyroom #rndletters");
  var roundnumber = 5;
  var letters = $("#rndletters").text().match("TE(.......)DH");
  var catfromdiv = $("#catr5").text();
  var rndstart = $("#rnd5start").text();
  $("#answerroundnumber").val(roundnumber);
  $("#answerroundstarted").val(rndstart);
  $("#answercategory").val(catfromdiv);
  $("#answeracroletters").val(letters[1]);
  slideRoundText();
  $("#roundtext").text("Round 5 - Write");
  enterCatText();
  $("#categorytext").text(catfromdiv);
  $("#acroletters").text(letters[1]);
  document.getElementById("acroletters").style.visibility="hidden";
  showLetters();
  $("#submittedtext").load("/room/familyroom #submittedtext");
  setTimeout(checkSubmittedNumber, 13000);
  $("#votediv").text("");
  $("#answerform").submit(function() {
    return acroValidate(letters[1]);
  });
  setTimeout(r5vote, <%= @r5writetime %>*1000);
}

function r5vote() {
  slideRoundText();
  $("#acceptedtext").hide();
  function showCatForVote(){
    $("#votecat").show();
    $("#votecat").text("Category: <%= @round5cat %>");
  }
  setTimeout(showCatForVote, 2500);
  document.getElementById("categorytext").style.visibility="hidden";
  document.getElementById("submittedtext").style.visibility="hidden";
  $("#roundtext").text("Round 5 - Vote");
  $('#answerfield').addClass('animated fadeOutDown');
  $("#acroletters").addClass('animated fadeOutUp');
  document.getElementById("answertextfield").style.visibility="hidden";
  $("#votediv").load("/room/familyroom #votediv");
  $("#resultsdiv").text("");
  setTimeout(votingRound, 2500);
  vtimer();
  playerCountCheck();
  setTimeout(r5res, <%= @r5votetime %>*1000);
}

function r5res() {
  slideRoundText();
  $("#votediv").dialog('close');
  $("#votediv").hide();
  $("#votecat").hide();
  $("#timertext").hide();
  $("#answertextfield").val("");
  $("#resultsdiv").load("/room/familyroom #resultsdiv");
  setTimeout(resultsRound, 2500);
  $("#roundtext").text("Round 5 - Results");
  $("#rndletters").load("/room/familyroom #rndletters");
  $("#gamedata").load("/room/familyroom #gamedata");
  setTimeout(loadTimesAndSyncCheck('r6prep'),2000);
  $("#tweetwinner").hide();
  setTimeout(loadTweet, 5750);
}

function r6prep() {
  slideRoundText();
  hideResultsDialog();
  $("#roundtext").text("Round 6/10 - Get ready!");
  $("#answerformdiv").load("/room/familyroom #answerformdiv");
  $("#submittedtext").text("0");
  setTimeout(r6write, <%= @r6preptime %>*1000);
}

function r6write() {
  roundPrep();
  $("#rndletters").load("/room/familyroom #rndletters");
  var roundnumber = 6;
  var letters = $("#rndletters").text().match("CH(...)BK");
  var catfromdiv = $("#catr6").text();
  var rndstart = $("#rnd6start").text();
  $("#answerroundnumber").val(roundnumber);
  $("#answerroundstarted").val(rndstart);
  $("#answercategory").val(catfromdiv);
  $("#answeracroletters").val(letters[1]);
  slideRoundText();
  $("#roundtext").text("Round 6 - Write");
  enterCatText();
  $("#categorytext").text(catfromdiv);
  $("#acroletters").text(letters[1]);
  document.getElementById("acroletters").style.visibility="hidden";
  showLetters();
  $("#submittedtext").load("/room/familyroom #submittedtext");
  setTimeout(checkSubmittedNumber, 7000);
  $("#votediv").text("");
  $("#answerform").submit(function() {
    return acroValidate(letters[1]);
  });
  setTimeout(r6vote, <%= @r6writetime %>*1000);
}

function r6vote() {
  slideRoundText();
  document.getElementById("categorytext").style.visibility="hidden";
  document.getElementById("submittedtext").style.visibility="hidden";
  $("#acceptedtext").hide();
  function showCatForVote(){
    $("#votecat").show();
    $("#votecat").text("Category: <%= @round6cat %>");
  }
  setTimeout(showCatForVote, 2500);
  $("#roundtext").text("Round 6 - Vote");
  $('#answerfield').addClass('animated fadeOutDown');
  $("#acroletters").addClass('animated fadeOutUp');
  document.getElementById("answertextfield").style.visibility="hidden";
  $("#votediv").load("/room/familyroom #votediv");
  $("#resultsdiv").text("");
  setTimeout(votingRound, 2500);
  vtimer();
  playerCountCheck();
  setTimeout(r6res, <%= @r6votetime %>*1000);
}

function r6res() {
  slideRoundText();
  $("#votediv").dialog('close');
  $("#votediv").hide();
  $("#votecat").hide();
  $("#timertext").hide();
  $("#timertext").hide();
  $("#answertextfield").val("");
  $("#resultsdiv").load("/room/familyroom #resultsdiv");
  setTimeout(resultsRound, 2500);
  $("#roundtext").text("Round 6 - Results");
  $("#rndletters").load("/room/familyroom #rndletters");
  $("#gamedata").load("/room/familyroom #gamedata");
  setTimeout(loadTimesAndSyncCheck('r7prep'),2000);
  $("#tweetwinner").hide();
  setTimeout(loadTweet, 5750);
}

function r7prep() {
  slideRoundText();
  hideResultsDialog();
  $("#roundtext").text("Round 7/10 - Get ready!");
  $("#answerformdiv").load("/room/familyroom #answerformdiv");
  $("#submittedtext").text("0");
  setTimeout(r7write, <%= @r7preptime %>*1000);
}

function r7write() {
  roundPrep();
  $("#rndletters").load("/room/familyroom #rndletters");
  var roundnumber = 7;
  var letters = $("#rndletters").text().match("VG(....)BV");
  var catfromdiv = $("#catr7").text();
  var rndstart = $("#rnd7start").text();
  $("#answerroundnumber").val(roundnumber);
  $("#answerroundstarted").val(rndstart);
  $("#answercategory").val(catfromdiv);
  $("#answeracroletters").val(letters[1]);
  slideRoundText();
  $("#roundtext").text("Round 7 - Write");
  enterCatText();
  $("#categorytext").text(catfromdiv);
  $("#acroletters").text(letters[1]);
  document.getElementById("acroletters").style.visibility="hidden";
  showLetters();
  $("#submittedtext").load("/room/familyroom #submittedtext");
  setTimeout(checkSubmittedNumber, 8500);
  $("#votediv").text("");
  $("#answerform").submit(function() {
    return acroValidate(letters[1]);
  });
  setTimeout(r7vote, <%= @r7writetime %>*1000);
}

function r7vote() {
  slideRoundText();
  $("#acceptedtext").hide();
  function showCatForVote(){
    $("#votecat").show();
    $("#votecat").text("Category: <%= @round7cat %>");
  }
  setTimeout(showCatForVote, 2500);
  document.getElementById("categorytext").style.visibility="hidden";
  document.getElementById("submittedtext").style.visibility="hidden";
  $("#roundtext").text("Round 7 - Vote");
  $('#answerfield').addClass('animated fadeOutDown');
  $("#acroletters").addClass('animated fadeOutUp');
  document.getElementById("answertextfield").style.visibility="hidden";
  $("#votediv").load("/room/familyroom #votediv");
  $("#resultsdiv").text("");
  setTimeout(votingRound, 2500);
  vtimer();
  playerCountCheck();
  setTimeout(r7res, <%= @r7votetime %>*1000);
}

function r7res() {
  slideRoundText();
  $("#votediv").dialog('close');
  $("#votediv").hide();
  $("#votecat").hide();
  $("#timertext").hide();
  $("#answertextfield").val("");
  $("#resultsdiv").load("/room/familyroom #resultsdiv");
  setTimeout(resultsRound, 2500);
  $("#roundtext").text("Round 7 - Results");
  $("#rndletters").load("/room/familyroom #rndletters");
  $("#gamedata").load("/room/familyroom #gamedata");
  setTimeout(loadTimesAndSyncCheck('r8prep'),2000);
  $("#tweetwinner").hide();
  setTimeout(loadTweet, 5750);
}

function r8prep() {
  slideRoundText();
  hideResultsDialog();
  $("#roundtext").text("Round 8/10 - Get ready!");
  $("#answerformdiv").load("/room/familyroom #answerformdiv");
  $("#submittedtext").text("0");
  setTimeout(r8write, <%= @r8preptime %>*1000);
}

function r8write() {
  roundPrep();
  $("#rndletters").load("/room/familyroom #rndletters");
  var roundnumber = 8;
  var letters = $("#rndletters").text().match("FY(.....)YJ");
  var catfromdiv = $("#catr8").text();
  var rndstart = $("#rnd8start").text();
  $("#answerroundnumber").val(roundnumber);
  $("#answerroundstarted").val(rndstart);
  $("#answercategory").val(catfromdiv);
  $("#answeracroletters").val(letters[1]);
  slideRoundText();
  $("#roundtext").text("Round 8 - Write");
  enterCatText();
  $("#categorytext").text(catfromdiv);
  $("#acroletters").text(letters[1]);
  document.getElementById("acroletters").style.visibility="hidden";
  showLetters();
  $("#submittedtext").load("/room/familyroom #submittedtext");
  setTimeout(checkSubmittedNumber, 10000);
  $("#votediv").text("");
  $("#answerform").submit(function() {
    return acroValidate(letters[1]);
  });
  setTimeout(r8vote, <%= @r8writetime %>*1000);
}

function r8vote() {
  slideRoundText();
  $("#acceptedtext").hide();
  function showCatForVote(){
    $("#votecat").show();
    $("#votecat").text("Category: <%= @round8cat %>");
  }
  setTimeout(showCatForVote, 2500);
  document.getElementById("categorytext").style.visibility="hidden";
  document.getElementById("submittedtext").style.visibility="hidden";
  $("#roundtext").text("Round 8 - Vote");
  $('#answerfield').addClass('animated fadeOutDown');
  $("#acroletters").addClass('animated fadeOutUp');
  document.getElementById("answertextfield").style.visibility="hidden";
  $("#votediv").load("/room/familyroom #votediv");
  $("#resultsdiv").text("");
  setTimeout(votingRound, 2500);
  vtimer();
  playerCountCheck();
  setTimeout(r8res, <%= @r8votetime %>*1000);
}

function r8res() {
  slideRoundText();
  $("#votediv").dialog('close');
  $("#votediv").hide();
  $("#votecat").hide();
  $("#timertext").hide();
  $("#answertextfield").val("");
  $("#resultsdiv").load("/room/familyroom #resultsdiv");
  setTimeout(resultsRound, 2500);
  $("#roundtext").text("Round 8 - Results");
  $("#rndletters").load("/room/familyroom #rndletters");
  $("#gamedata").load("/room/familyroom #gamedata");
  setTimeout(loadTimesAndSyncCheck('r9prep'),2000);
  $("#tweetwinner").hide();
  setTimeout(loadTweet, 5750);
}

function r9prep() {
  slideRoundText();
  hideResultsDialog();
  $("#roundtext").text("Round 9/10 - Get ready!");
  $("#answerformdiv").load("/room/familyroom #answerformdiv");
  $("#submittedtext").text("0");
  setTimeout(r9write, <%= @r9preptime %>*1000);
}

function r9write() {
  roundPrep();
  $("#rndletters").load("/room/familyroom #rndletters");
  var roundnumber = 9;
  var letters = $("#rndletters").text().match("QH(......)FO");
  var catfromdiv = $("#catr9").text();
  var rndstart = $("#rnd9start").text();
  $("#answerroundnumber").val(roundnumber);
  $("#answerroundstarted").val(rndstart);
  $("#answercategory").val(catfromdiv);
  $("#answeracroletters").val(letters[1]);
  slideRoundText();
  $("#roundtext").text("Round 9 - Write");
  enterCatText();
  $("#categorytext").text(catfromdiv);
  $("#acroletters").text(letters[1]);
  document.getElementById("acroletters").style.visibility="hidden";
  showLetters();
  $("#submittedtext").load("/room/familyroom #submittedtext");
  setTimeout(checkSubmittedNumber, 11500);
  $("#votediv").text("");
  $("#answerform").submit(function() {
    return acroValidate(letters[1]);
  });
  setTimeout(r9vote, <%= @r9writetime %>*1000);
}

function r9vote() {
  slideRoundText();
  $("#acceptedtext").hide();
  function showCatForVote(){
    $("#votecat").show();
    $("#votecat").text("Category: <%= @round9cat %>");
  }
  setTimeout(showCatForVote, 2500);
  document.getElementById("categorytext").style.visibility="hidden";
  document.getElementById("submittedtext").style.visibility="hidden";
  $("#roundtext").text("Round 9 - Vote");
  $('#answerfield').addClass('animated fadeOutDown');
  $("#acroletters").addClass('animated fadeOutUp');
  document.getElementById("answertextfield").style.visibility="hidden";
  $("#votediv").load("/room/familyroom #votediv");
  $("#resultsdiv").text("");
  setTimeout(votingRound, 2500);
  vtimer();
  playerCountCheck();
  setTimeout(r9res, <%= @r9votetime %>*1000);
}

function r9res() {
  slideRoundText();
  $("#votediv").dialog('close');
  $("#votediv").hide();
  $("#votecat").hide();
  $("#timertext").hide();
  $("#answertextfield").val("");
  $("#resultsdiv").load("/room/familyroom #resultsdiv");
  setTimeout(resultsRound, 2500);
  $("#roundtext").text("Round 9 - Results");
  $("#rndletters").load("/room/familyroom #rndletters");
  $("#gamedata").load("/room/familyroom #gamedata");
  setTimeout(loadTimesAndSyncCheck('r10prep'),2000);
  $("#tweetwinner").hide();
  setTimeout(loadTweet, 5750);
}

function r10prep() {
  slideRoundText();
  hideResultsDialog();
  $("#roundtext").text("Last round - Get ready!");
  $("#answerformdiv").load("/room/familyroom #answerformdiv");
  $("#submittedtext").text("0");
  setTimeout(r10write, <%= @r10preptime %>*1000);
}

function r10write() {
  roundPrep();
  $("#rndletters").load("/room/familyroom #rndletters");
  var roundnumber = 10;
  var letters = $("#rndletters").text().match("HN(.......)GH");
  var catfromdiv = $("#catr10").text();
  var rndstart = $("#rnd10start").text();
  $("#answerroundnumber").val(roundnumber);
  $("#answerroundstarted").val(rndstart);
  $("#answercategory").val(catfromdiv);
  $("#answeracroletters").val(letters[1]);
  slideRoundText();
  $("#roundtext").text("Round 10 - Write");
  enterCatText();
  $("#categorytext").text(catfromdiv);
  $("#acroletters").text(letters[1]);
  document.getElementById("acroletters").style.visibility="hidden";
  showLetters();
  $("#submittedtext").load("/room/familyroom #submittedtext");
  setTimeout(checkSubmittedNumber, 13000);
  $("#votediv").text("");
  $("#answerform").submit(function() {
    return acroValidate(letters[1]);
  });
  setTimeout(r10vote, <%= @r10writetime %>*1000);
}

function r10vote() {
  slideRoundText();
  $("#acceptedtext").hide();
  function showCatForVote(){
    $("#votecat").show();
    $("#votecat").text("Category: <%= @round10cat %>");
  }
  setTimeout(showCatForVote, 2500);
  document.getElementById("categorytext").style.visibility="hidden";
  document.getElementById("submittedtext").style.visibility="hidden";
  $("#roundtext").text("Round 10 - Vote");
  $('#answerfield').addClass('animated fadeOutDown');
  $("#acroletters").addClass('animated fadeOutUp');
  document.getElementById("answertextfield").style.visibility="hidden";
  $("#votediv").load("/room/familyroom #votediv");
  $("#resultsdiv").text("");
  setTimeout(votingRound, 2500);
  vtimer();
  playerCountCheck();
  setTimeout(r10res, <%= @r10votetime %>*1000);
}

function r10res() {
  slideRoundText();
  $("#votediv").dialog('close');
  $("#votediv").hide();
  $("#votecat").hide();
  $("#timertext").hide();
  $("#answertextfield").val("");
  $("#resultsdiv").load("/room/familyroom #resultsdiv");
  setTimeout(resultsRound, 2500);
  $("#roundtext").text("Round 10 - Results");
  $("#rndletters").load("/room/familyroom #rndletters");
  $("#gamedata").load("/room/familyroom #gamedata");
  setTimeout(updateEndgameStats, 4000);
  function prepareToShowWinner() {
    $("#endofgamediv").load("/room/familyroom #endofgamediv");
  }
  setTimeout(prepareToShowWinner, 6000);
  setTimeout(loadTimesAndSyncCheck('finalResults'),2000);
  $("#tweetwinner").hide();
  setTimeout(loadTweet, 5750);
}

function finalResults() {
  slideRoundText();
  hideResultsDialog();
  $("#roundtext").text("The winner is...");
  $("#endofgamediv").load("/room/familyroom #endofgamediv");
  function playerNewGameNotify() {
    $("#acceptedtext").hide();
    $("#acroletters").show();
    document.getElementById("submittedtext").style.visibility="hidden";
    $("#acroletters").css('fontSize', '100%')
                     .html("<br/>Stay tuned for<br/>new game...")
                     .removeClass('animated fadeOutUp');
    slideRoundText();
    $("#roundtext").text("Take a breath...");
    $('#answerfield').addClass('animated fadeOutDown');
    $("#answertextfield").attr("disabled", true);
    $("#answersubmit").attr("disabled", true);
    hideEndGameDialog();
  }
  setTimeout(playerNewGameNotify, 15000);
  setTimeout(gameOver, 1500);
  setTimeout(readyForNewGame, <%= @finalresultstime %>*1000);
}

function readyForNewGame() {
  playerEnterInit();
  $("#acceptedtext").hide();
  $("#acroletters").show();
  document.getElementById("submittedtext").style.visibility="hidden";
  $("#acroletters").css('fontSize', '100%')
                   .html("<br/>New game<br/>now loading...")
                   .removeClass('animated fadeOutUp');
  slideRoundText();
  $("#roundtext").text("New game loading...");
  $('#answerfield').addClass('animated fadeOutDown');
  $("#answertextfield").attr("disabled", true);
  $("#answersubmit").attr("disabled", true);
  hideEndGameDialog();
  function loadNewData(){
    $("#rndletters").load("/room/familyroom #rndletters");
    $("#gamedata").load("/room/familyroom #gamedata");
  }
  loadNewData();
  var roundtojoinraw = $("#roundtojoindiv").text();
  var roundtojoin = window[roundtojoinraw];
  var timetojoin = $("#timetojoindiv").text();
  setTimeout(roundtojoin, timetojoin*1000);
}
</script>
